<project default="make" xmlns:if="ant:if" xmlns:unless="ant:unless">

<taskdef resource="net/sf/antcontrib/antcontrib.properties"/>

<target name="make">
  <property name="thisdir" value="${user.dir}"/>
  <property name="utilitydir" value="${thisdir}/utilities/"/>
  <!--test skip-gc.txt to preserve the old genericode model file-->
  <available property="skip-gc" file="skip-gc.txt"/>
  <echo if:set="skip-gc" message="!!!!!!!!!!!!!! Incomplete execution requested: UBL-Entities-2.3.gc not being generated from the given spreadsheets; delete skip-gc.txt to restore normal operation!!!!!!!!!!!!!!!!"/>
  <!--test skip-spreadsheet.txt for no spreadsheets-->
  <available property="skip-spreadsheet-generation" file="skip-ss.txt"/>
  <echo if:set="skip-spreadsheet-generation" message="!!!!!!!!!!!!!! Incomplete execution requested: ODS and XLS spreadsheets not being generated from UBL-Entities-2.3.gc ; delete skip-ss.txt to restore normal operation!!!!!!!!!!!!!!!!"/>
  <!--test skip-html.txt for no detailed HTML-->
  <available property="skip-html-generation" file="skip-html.txt"/>
  <echo if:set="skip-html-generation" message="!!!!!!!!!!!!!! Incomplete execution requested: detailed HTML reports not being generated from UBL-Entities-2.3.gc; delete skip-html.txt to restore normal operation!!!!!!!!!!!!!!!!"/>
  <!--test skip-all-html.txt for no all HTML-->
  <available property="skip-all-html-generation" file="skip-all-html.txt"/>
  <echo if:set="skip-all-html-generation" message="!!!!!!!!!!!!!! Incomplete execution requested: summary HTML report not being generated from UBL-Entities-2.3.gc; delete skip-all-html.txt to restore normal operation!!!!!!!!!!!!!!!!"/>
  <!--override abieExtensions as "no" for UBL 2.2 and earlier-->
  <property name="abieExtensions" value="yes"/>
  <!--software timestamps-->
  <property name="gc2obdndr" value="20200604-1750z"/>
  <property name="ods2obdgc" value="20200412-1320z"/>
  <property name="cvagcxsl"  value="20130416-0040z"/>
  <property name="cva2sch"   value="20130207-1940z"/>
  <property name="gc2odsxml" value="20170727-0220z"/>
  <!--documentation-->
  <echo message="gc2obdndr=${gc2obdndr}"/>
  <echo message="ods2obdgc=${ods2obdgc}"/>
  <echo message="gc2odsxml=${gc2odsxml}"/>
  <echo message="cvagcxsl=${cvagcxsl}"/>
  <echo message="cva2sch=${cva2sch}"/>
  <echo message="dir=${dir}"/>
  <echo message="utilitydir=${utilitydir}"/>
  <echo message="thisdir=${thisdir}"/>
  <echo message="rawdir=${rawdir}"/>
  <echo message="title=${title}"/>
  <echo message="package=${package}"/>
  <echo message="UBLversion=${UBLversion}"/>
  <echo message="UBLstage=${UBLstage}"/>
  <echo message="UBLprevStageVersion=${UBLprevStageVersion}"/>
  <echo message="UBLprevStage=${UBLprevStage}"/>
  <echo message="UBLprevVersion=${UBLprevVersion}"/>
  <echo message="abieExtensions=${abieExtensions}"/>
  <echo message="version=${version}"/>
  <echo message="libraryGoogle=${libraryGoogle}"/>
  <echo message="documentsGoogle=${documentsGoogle}"/>
  <echo message="signatureGoogle=${signatureGoogle}"/>
  
  <available property="gc2obdndr-exists"
         file="${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-gc2obdndr.xsl"/>
  <echo unless:set="gc2obdndr-exists" 
        message="Cannot find gc2obdndr=${gc2obdndr}"/>
  <available property="ods2obdgc-exists"
file="${utilitydir}Crane-ods2obdgc-${ods2obdgc}/Crane-ods2obdgc.xsl"/>
  <echo unless:set="ods2obdgc-exists" 
        message="Cannot find ods2obdgc=${ods2obdgc}"/>
  <available property="gc2odsxml-exists"
file="${utilitydir}Crane-gc2odsxml-${gc2odsxml}/Crane-gc2odsxml.xsl"/>
  <echo unless:set="gc2odsxml-exists" 
        message="Cannot find gc2odsxml=${gc2odsxml}"/>
  <available property="cvagcxsl-exists"
file="${utilitydir}Crane-cva-gc-xsl-${cvagcxsl}/Crane-cva2html.xsl"/>
  <echo unless:set="cvagcxsl-exists" 
        message="Cannot find cvagcxsl=${cvagcxsl}"/>
  <available property="cva2sch-exists"
file="${utilitydir}Crane-cva2sch-${cva2sch}/utility/iso_schematron_assembly.xsl"/>
  <echo unless:set="cva2sch-exists" 
        message="Cannot find cva2sch=${cva2sch}"/>
  
  <!--start with the raw files-->
  <copy preservelastmodified="true" todir="${dir}/${UBLstage}-${UBLversion}">
    <fileset dir="${rawdir}">
      <include name="**"/>
    </fileset>
  </copy>
  <copy preservelastmodified="true" todir="${dir}/${UBLstage}-${UBLversion}/xsdrt">
    <fileset dir="${rawdir}/xsd">
      <include name="**"/>
    </fileset>
  </copy>
  <!--and the configuration files found in the base directory-->
  <copy preservelastmodified="true" todir="${dir}">
    <fileset dir=".">
      <include name="*"/>
      <exclude name="**/.git/**"/>
      <exclude name="**/.github/**"/>
      <exclude name="**/utilities/**"/>
      <exclude name="**/${dir}/**"/>
      <exclude name="**/${rawdir}/**"/>
    </fileset>
  </copy>

  <!--create GC files for business and signature-->
  <sequential unless:set="skip-gc">
    <delete file="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
    <delete file="${dir}/UBL-Entities-${UBLversion}.gc"/>
    
    <exec executable="wget">
      <arg value="--no-check-certificate"/>
      <arg value="-O"/><arg value="${dir}/UBL-Signature-Google.ods"/>
      <arg value="${signatureGoogle}/export?format=ods"/>
    </exec>
    <uptodate targetfile="${dir}/UBL-Signature-Entities-${UBLversion}.gc"
              property=  "gc-sig-files-okay">
      <srcfiles dir="${dir}">
        <include name="UBL-Signature-Google.ods"/>
        <include name="ident-UBL-Signature.xml"/>
        <include name="massageModelName.xml"/>
      </srcfiles>
    </uptodate>
    <condition property="gc-sig-okay">
      <or>
        <equals arg1="${skip-gc}" arg2="true"/>
        <isset property="gc-sig-files-okay"/>
      </or>
    </condition>
    <property name="lengthen-uri"
              location="${dir}/massageModelName.xml"/>
    <property name="ident-uri-sig"
              location="${dir}/ident-UBL-Signature.xml"/>
    <antcallback target="-ods2gc" return="returnGCsig">
      <param name="okay"   value="gc-sig-okay"/>
      <param name="source" value="${dir}/UBL-Signature-Google.ods"/>
      <param name="target" value="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
      <param name="identification-uri" value="${ident-uri-sig}"/>
      <param name="lengthen-model-name-uri" value="${lengthen-uri}"/>
      <param name="returnProperty" value="returnGCsig"/>
    </antcallback>
    <copy preservelastmodified="true" todir="${dir}/${UBLstage}-${UBLversion}/mod/" file="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
    <condition property="gcSigErrors">
      <and>
        <isset property="returnGCsig"/>
        <not>
          <equals arg1="${returnGCsig}" arg2="0"/>
        </not>
      </and>
    </condition>
    <echo if:set="gcSigErrors"
          message="ERROR creating Signature Entities genericode file"/>
    <touch if:set="gcSigErrors"
           message="VALID-SIGNATURE-GC-FILE-NOT-GENERATED"/>
  
    <exec executable="wget">
      <arg value="--no-check-certificate"/>
      <arg value="-O"/><arg value="${dir}/UBL-Library-Google.ods"/>
      <arg value="${libraryGoogle}/export?format=ods"/>
    </exec>
    <exec executable="wget">
      <arg value="--no-check-certificate"/>
      <arg value="-O"/><arg value="${dir}/UBL-Documents-Google.ods"/>
      <arg value="${documentsGoogle}/export?format=ods"/>
    </exec>
    <uptodate targetfile="${dir}/UBL-Entities-${UBLversion}.gc"
              property=  "gc-files-okay">
      <srcfiles dir="${dir}">
        <include name="UBL-Library-Google.ods"/>
        <include name="UBL-Documents-Google.ods"/>
        <include name="ident-UBL.xml"/>
        <include name="massageModelName.xml"/>
      </srcfiles>
    </uptodate>
    <condition property="gc-okay">
      <or>
        <equals arg1="${skip-gc}" arg2="true"/>
        <isset property="gc-files-okay"/>
      </or>
    </condition>
    <property name="lengthen-uri"
              location="${dir}/massageModelName.xml"/>
    <property name="ident-uri"
              location="${dir}/ident-UBL.xml"/>
    <antcallback target="-ods2gc" return="returnGC">
      <param name="okay"   value="gc-okay"/>
      <param name="source" value="${dir}/UBL-Library-Google.ods,${dir}/UBL-Documents-Google.ods"/>
      <param name="target" value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="identification-uri" value="${ident-uri}"/>
      <param name="lengthen-model-name-uri" value="${lengthen-uri}"/>
      <param name="returnProperty" value="returnGC"/>
    </antcallback>
    <copy preservelastmodified="true" todir="${dir}/${UBLstage}-${UBLversion}/mod/"
          file="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <condition property="gcBaseErrors">
      <and>
        <isset property="returnGC"/>
        <not>
          <equals arg1="${returnGC}" arg2="0"/>
        </not>
      </and>
    </condition>
    <echo if:set="gcBaseErrors" message="ERROR problem with UBL-Entities-${UBLversion}.gc"/>
    <touch if:set="gcErrors"
           message="VALID-GC-FILE-NOT-GENERATED"/>

    <condition property="gcErrors">
      <or>
        <isset property="gcSigErrors"/>
        <isset property="gcBaseErrors"/>
      </or>
    </condition>
  </sequential>

  <!--create CVA/XSD/XSL files-->
  <sequential unless:set="gcErrors">
    
  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/val/UBL-DefaultDTQ-${UBLversion}.xsl"
            property=  "xsd-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Entities-${UBLversion}.gc"/>
      <include name="config-UBL.xml"/>
      <include name="UBL-DefaultDTQ-shell.sch"/>
      <include name="UBL-CVA-Skeleton.cva"/>
    </srcfiles>
  </uptodate>
  <antcallback target="-gc2ndr-check-only" return="returnStage"><!--against ${UBLprevStageVersion}-${UBLprevStage}-->
    <param name="okay"    value="xsd-okay"/>
    <param name="compare" value="UBL-Entities-${UBLprevStageVersion}-${UBLprevStage}.gc"/>
    <param name="title"
           value="Universal Business Language (UBL) ${UBLversion} ${UBLstage} to ${UBLprevStageVersion} ${UBLprevStage}"/>
    <param name="dbcmn"
        value="old2newDocBook-UBL-${UBLversion}-${UBLstage}-UBL-${UBLprevStageVersion}-${UBLprevStage}-library-ent.xml"/>
    <param name="dbmain" 
      value="old2newDocBook-UBL-${UBLversion}-${UBLstage}-UBL-${UBLprevStageVersion}-${UBLprevStage}-documents-ent.xml"/>
    <param name="dbhref"
           value="mod/summary/reports/All-UBL-${UBLversion}-Documents.html"/>
    <param name="report"  value="${dir}/check-ubl-${UBLversion}-${UBLstage}-ubl-${UBLprevStageVersion}-${UBLprevStage}.html"/>
    <param name="change"  value="UBL"/>
    <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <param name="config"  value="config-UBL.xml"/>
    <param name="words"   value="wordlist-UBL-${UBLversion}.txt"/>
    <param name="library" value="UBL-CommonLibrary-${UBLversion}"/>
    <param name="fatal"   value="no"/>
    <param name="returnProperty" value="returnStage"/>
  </antcallback>
  <antcallback target="-gc2ndr" return="returnVersion"><!--against UBL ${UBLversion}-->
    <param name="okay"    value="xsd-okay"/>
    <param name="compare" value="UBL-Entities-${UBLprevVersion}.gc"/>
    <param name="title"
           value="Universal Business Language (UBL) ${UBLversion} ${UBLstage} to ${UBLprevVersion}"/>
    <param name="dbcmn"
           value="old2newDocBook-UBL-${UBLversion}-${UBLstage}-UBL-${UBLprevVersion}-library-ent.xml"/>
    <param name="dbmain" 
           value="old2newDocBook-UBL-${UBLversion}-${UBLstage}-UBL-${UBLprevVersion}-documents-ent.xml"/>
    <param name="dbhref"
           value="mod/summary/reports/All-UBL-${UBLversion}-Documents.html"/>
    <param name="report"  value="${dir}/check-ubl-${UBLversion}-${UBLstage}-ubl-${UBLprevVersion}.html"/>
    <param name="change"  value="UBL"/>
    <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <param name="config"  value="config-UBL.xml"/>
    <param name="words"   value="wordlist-UBL-${UBLversion}.txt"/>
    <param name="library"  value="UBL-CommonLibrary-${UBLversion}"/>
    <param name="fatal"   value="yes"/>
    <param name="returnProperty" value="returnVersion"/>
  </antcallback>
  <condition property="ndrErrors">
    <and>
      <isset property="returnVersion"/>
      <not>
        <equals arg1="${returnVersion}" arg2="0"/>
      </not>
    </and>
  </condition>
    
  </sequential>
  <!--ensure everything so far so good-->
  <condition property="processFailed">
    <or>
      <isset property="gcErrors"/>
      <isset property="ndrErrors"/>
    </or>
  </condition>

  <sequential unless:set="processFailed">
    <!--prepare other artefacts-->
    <antcall target="-artefacts"/>
    
    <!--prepare reports-->
    <antcall target="-reports"/>

    <!--check code lists-->
    <antcall target="-codelists"/>

    <!--check samples-->
    <antcall target="-samples"/>
  </sequential>
  
  <!--package it all up-->
  <antcall target="-package"/>
</target>

<!--========================================================================-->

<target name="-artefacts">
  <antcall target="-gc2cva">
    <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <param name="config"  value="config-UBL.xml"/>
  </antcall>

  <delete dir="${dir}/os-UBL-2.0"/>
  <copy preservelastmodified="true" todir="${dir}/os-UBL-2.0">
    <fileset dir="os-UBL-2.0/">
      <include name="**"/>
    </fileset>
  </copy>
  <delete dir="${dir}/os-UBL-2.1"/>
  <copy preservelastmodified="true" todir="${dir}/os-UBL-2.1">
    <fileset dir="os-UBL-2.1/">
      <include name="**"/>
    </fileset>
  </copy>
  <delete dir="${dir}/os-UBL-2.2"/>
  <copy preservelastmodified="true" todir="${dir}/os-UBL-2.2">
    <fileset dir="os-UBL-2.2/">
      <include name="**"/>
    </fileset>
  </copy>
  <copy preservelastmodified="true" tofile="${dir}/${UBLstage}-${UBLversion}/cva/UBL-DefaultDTQ-${UBLversion}.sch"
        file="UBL-DefaultDTQ-shell.sch"/>
  <echo message='Creating Schematron document constraints from "${source}" GC file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:UBL-DocumentConstraints-2.3.pattern.xsl"/>
     <arg value="-s:${dir}/UBL-Entities-${UBLversion}.gc"/>
     <arg value="-o:${dir}/${UBLstage}-${UBLversion}/cva/UBL-DocumentConstraints-2.3.pattern.sch"/>
  </java>
  <antcall target="-cva2xsl">
    <param name="okay"    value="xsd-okay"/>
    <param name="cvain"   value="${dir}/${UBLstage}-${UBLversion}/cva/UBL-DefaultDTQ-${UBLversion}.cva"/>
    <param name="cvaout"  value="${dir}/${UBLstage}-${UBLversion}/cva/UBL-DefaultDTQ-${UBLversion}.html"/>
    <param name="schin"   value="${dir}/${UBLstage}-${UBLversion}/cva/UBL-DefaultDTQ-${UBLversion}.sch"/>
    <param name="schadd"  value="${dir}/${UBLstage}-${UBLversion}/cva/UBL-DefaultDTQ-${UBLversion}.pattern.sch"/>
    <param name="xslout"  value="${dir}/${UBLstage}-${UBLversion}/val/UBL-DefaultDTQ-${UBLversion}.xsl"/>
  </antcall>

  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/xsdrt/common/UBL-SignatureBasicComponents-${UBLversion}.xsd"
            property=  "xsd-sig-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Signature-Entities-${UBLversion}.gc"/>
      <include name="config-UBL-Signature.xml"/>
    </srcfiles>
  </uptodate>
  <antcall target="-gc2ndrExt">
    <param name="okay"    value="xsd-sig-okay"/>
    <param name="source"  value="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
    <param name="compare" value="UBL-Signature-Entities-${UBLprevVersion}.gc"/>
    <param name="config"  value="config-UBL-Signature.xml"/>
    <param name="basegc"  value="UBL-Entities-${UBLversion}.gc"/>
    <param name="basecf"  value="config-UBL.xml"/>
    <param name="title"   value="Universal Business Language (UBL) Signature"/>
    <param name="change"  value="UBL Signature"/>
    <param name="dbcmn"   value="old2newDocBook-UBL-Signature-library-ent.xml"/>
    <param name="dbmain"  value="old2newDocBook-UBL-Signature-documents-ent.xml"/>
    <param name="words"   value="wordlist-UBL-Signature-${UBLversion}.txt"/>
    <param name="report"  value="${dir}/check-ubl-signature-${UBLversion}-${UBLstage}.html"/>
    <param name="library"  value="UBL-SignatureLibrary-${UBLversion}"/>
  </antcall>    

  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Entities-${UBLversion}.ods"
            property=  "display-file-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Entities-${UBLversion}.gc"/>
      <include name="skeletonDisplayEditSubset.ods"/>
    </srcfiles>
  </uptodate>
  <condition property="display-okay">
    <or>
      <istrue value="${display-file-okay}"/>
      <istrue value="${skip-spreadsheet-generation}"/>
    </or>
  </condition>
  <antcall target="-gc2ods">
    <param name="okay"   value="display-okay"/>
    <param name="source" value="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <param name="target" value="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Entities-${UBLversion}.ods"/>
    <param name="skeleton" value="skeletonDisplayEditSubset.ods"/>
    <param name="shorten" value=""/>
  </antcall>

  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Signature-Entities-${UBLversion}.ods"
            property=  "display-sig-file-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Signature-Entities-${UBLversion}.gc"/>
      <include name="skeletonDisplayEditSubset.ods"/>
    </srcfiles>
  </uptodate>
  <condition property="display-sig-okay">
    <or>
      <istrue value="${display-sig-file-okay}"/>
      <istrue value="${skip-spreadsheet-generation}"/>
    </or>
  </condition>
  <antcall target="-gc2ods">
    <param name="okay"   value="display-sig-okay"/>
    <param name="source" value="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
    <param name="target" value="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Signature-Entities-${UBLversion}.ods"/>
    <param name="skeleton" value="skeletonDisplayEditSubset.ods"/>
  </antcall>

  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Signature-Entities-${UBLversion}.xls"
            property=  "xls-sig-file-okay">
    <srcfiles dir="${dir}">
      <include name="${UBLstage}-${UBLversion}/mod/UBL-Signature-Entities-${UBLversion}.ods"/>
    </srcfiles>
  </uptodate>
  <condition property="xls-sig-okay">
    <or>
      <istrue value="${xls-sig-file-okay}"/>
      <istrue value="${skip-spreadsheet-generation}"/>
    </or>
  </condition>
  <antcall target="-ods2xls">
    <param name="okay"   value="xls-sig-okay"/>
    <param name="sourcedir" value="${dir}/${UBLstage}-${UBLversion}/mod"/>
    <param name="sourcefilenoext" value="UBL-Signature-Entities-${UBLversion}"/>
  </antcall>

  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/UBL-Entities-${UBLversion}.xls"
            property=  "xls-file-okay">
    <srcfiles dir="${dir}">
      <include name="${UBLstage}-${UBLversion}/mod/UBL-Entities-${UBLversion}.ods"/>
    </srcfiles>
  </uptodate>
  <condition property="xls-okay">
    <or>
      <istrue value="${xls-file-okay}"/>
      <istrue value="${skip-spreadsheet-generation}"/>
    </or>
  </condition>
  <antcall target="-ods2xls">
    <param name="okay"   value="xls-okay"/>
    <param name="sourcedir" value="${dir}/${UBLstage}-${UBLversion}/mod"/>
    <param name="sourcefilenoext" value="UBL-Entities-${UBLversion}"/>
  </antcall>
</target>

<!--create reports-->
<target name="-report-check">
  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/summary/reports/UBL-WeightStatement-${UBLversion}.html"
            property=  "html-file-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Entities-${UBLversion}.gc"/>
    </srcfiles>
  </uptodate>
  <condition property="html-okay">
    <or>
      <istrue value="${html-file-okay}"/>
      <istrue value="${skip-html-generation}"/>
    </or>
  </condition>
</target>

<target name="-report-all-only" if="skip-html-generation" unless="skip-all-html-generation">
  <echo message='Creating "all documents" report...'/>
  <antcall target="-gc2html">
    <param name="source"             value="${dir}/UBL-Entities-${UBLversion}.gc"/>
    <param name="library"            value=""/>
    <param name="group"              value="0"/>
    <param name="parallelGroupCount" value="0"/>
    <param name="doAllOnly"          value="yes"/>
  </antcall>  
</target>

<target name="-reports" depends="-report-check,-report-all-only" unless="html-okay">
<parallel>  
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="1"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="2"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="3"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="4"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="5"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="6"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="7"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="8"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="9"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="10"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="11"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="12"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="13"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="14"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="15"/>
    </antcall>  
  </sequential>
  <sequential>
    <antcall target="-gc2html">
      <param name="okay"    value="html-okay"/>
      <param name="source"  value="${dir}/UBL-Entities-${UBLversion}.gc"/>
      <param name="library"  value=""/>
      <param name="group"   value="16"/>
    </antcall>  
  </sequential>
</parallel>
  <uptodate targetfile="${dir}/${UBLstage}-${UBLversion}/mod/summary/reports/All-UBL-${UBLversion}-SignatureExtensionComponents.html"
            property=  "html-sig-file-okay">
    <srcfiles dir="${dir}">
      <include name="UBL-Signature-Entities-${UBLversion}.gc"/>
    </srcfiles>
  </uptodate>
  <condition property="html-sig-okay">
    <or>
      <istrue value="${html-sig-file-okay}"/>
    </or>
  </condition>
  <antcall target="-gc2html">
    <param name="okay"    value="html-sig-okay"/>
    <param name="source"  value="${dir}/UBL-Signature-Entities-${UBLversion}.gc"/>
    <param name="library"  value="UBL-SignatureLibrary-${UBLversion}"/>
    <param name="alldocsname" value="not-used-here"/>
    <param name="group"   value="0"/>
  </antcall>
  <move preservelastmodified="true" unless:set="html-sig-okay" tofile="${dir}/${UBLstage}-${UBLversion}/mod/summary/reports/All-UBL-${UBLversion}-SignatureExtensionComponents.html"
    file="${dir}/${UBLstage}-${UBLversion}/mod/summary/reports/UBL-CommonSignatureComponents-${UBLversion}.html"
       />
</target>

<target name="-ods2gc" unless="${okay}">
  <delete file="${dir}/${UBLstage}-${UBLversion}"/>
  <delete file="${target}"/>
  <echo message='Rebuilding "${target}" GC file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-ods2obdgc-${ods2obdgc}/Crane-ods2obdgc.xsl"/>
     <arg value="-o:${target}"/>
     <arg value="-it:ods-uri"/>
     <arg value="ods-uri=${source}"/>
     <arg value="identification-uri=${identification-uri}"/>
     <arg value="lengthen-model-name-uri=${lengthen-model-name-uri}"/>
  </java>
  <available property="done" file="${target}"/>
  <sequential unless:set="done">
    <echo message="Unable to create GC file: ${target}"/>
    <property unless:set="done" name="${returnProperty}" value="1"/>
  </sequential>
  <sequential if:set="done">
    <property name="jarLocation" location="${utilitydir}Crane-gc2obdndr-${gc2obdndr}/ubl/val"/>
    <echo message='Validating "${target}" GC file...'/>
    <java resultproperty="${returnProperty}" append="true" fork="true" classname="com.nwalsh.parsers.xjparse"
          classpath="${jarLocation}/xjparse.jar;${jarLocation}/resolver.jar;${jarLocation};">
       <arg value="-S"/>
       <arg value="${utilitydir}genericode/xsd/genericode.xsd"/>
       <arg value="${target}"/>
    </java>
  </sequential>
</target>

<target name="-gc2ods" unless="${okay}">
  <delete file="${target}"/>
  <echo message='Rebuilding "${target}" ODS file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2odsxml-${gc2odsxml}/Crane-gc2odsxml.xsl"/>
     <arg value="-o:${target}-dir/dummy"/>
     <arg value="-s:${source}"/>
     <arg value="skeleton-ods-uri=${dir}/${skeleton}"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
  </java>
  <available property="files" file="${target}-dir/content.xml"/>
  <echo unless:set="files" 
        message="Unable to create ODS XML file: ${target}-dir/"/>
  <zip destfile="${target}" basedir="${target}-dir" includes="**"/>
  <delete dir="${target}-dir"/>
  <available property="done" file="${target}"/>
  <echo unless:set="done" message="Unable to create ODS file: ${target}"/>
</target>

<target name="-ods2xls" unless="${okay}">
  <delete file="${sourcedir}/${sourcefilenoext}.xls"/>
  <echo message="Need to rebuild ${sourcedir}/${sourcefilenoext}.xls from ${sourcedir}/${sourcefilenoext}.ods..."/>
  <available property="ready" file="${sourcedir}/${sourcefilenoext}.ods"/>
  <echo unless:set="ready" message="Unable to find ODS file: ${sourcedir}/${sourcefilenoext}.ods"/>
  <exec executable="soffice">
    <arg value="--headless"/>
    <arg value="--convert-to"/>
    <arg value="xls"/>
    <arg value="--outdir"/>
    <arg value="${sourcedir}/"/>
    <arg value="${sourcedir}/${sourcefilenoext}.ods"/>
  </exec>
  <available property="done" file="${sourcedir}/${sourcefilenoext}.xls"/>
  <echo unless:set="done" message="Unable to create XLS file: ${sourcedir}/${sourcefilenoext}.xls"/>
</target>

<target name="-gc2ndr-check-only" unless="${okay}">
  <echo message='Checking "${source}" GC file against NDR and old "${compare}" to create "${report}"...'/>
  <echo message="Fail setting = ${fatal}"/>
  <touch file="${dir}/${words}"/>
  <property name="words-uri" location="${dir}/${words}"/>
  <property name="dict-uri" location="${dir}/spellcheck-UBL.txt"/>
  <java resultproperty="${returnProperty}" append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-checkgc4obdndr.xsl"/>
     <arg value="-o:${report}"/>
     <arg value="-s:${source}"/>
     <arg value="config-uri=${config}"/>
     <arg value="title-suffix=${title}"/>
     <arg value="change-suffix=${change}"/>
     <arg value="old-uri=${compare}"/>
     <arg value="docbook-common-uri=${dbcmn}"/>
     <arg value="docbook-maindoc-uri=${dbmain}"/>
     <arg value="all-documents-report-href=${dbhref}"/>
     <arg value="den-word-list-uri=${words-uri}"/>
     <arg value="common-library-singleton-model-name=${library}"/>
     <arg value="version-column-name=CurrentVersion"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
     <arg value="errors-are-fatal=${fatal}"/>
  </java>
  <echo message="Spell-checking the resulting word list into ${dir}/unexpectedWords.txt (run aspell -l EN -p ${dict-uri} check ${words-uri} if abend)..."/>
  <exec resultproperty="returnSpell" executable="sh">
    <arg value="-e"/>
    <arg value="-c"/>
    <arg value='aspell -l EN -p ${dict-uri} list &lt;${words-uri} | tee ${dir}/unexpectedWords.txt | wc -w | sed "s/ //g" | grep "^0$"'/>
  </exec>
  <condition property="reportSpell">
    <and>
      <equals arg1="${fatal}" arg2="yes"/>
      <isset property="returnSpell"/>
      <not>
        <equals arg1="${returnSpell}" arg2="0"/>
      </not>
    </and>
  </condition>
  <touch if:set="reportSpell" file="${dir}/${UBLstage}-${UBLversion}/NDR-SPELL-CHECK-WARNING.txt"/>
</target>

<target name="-gc2ndr" unless="${okay}">
  <antcallback target="-gc2ndr-check-only" return="${returnProperty}"/>
</target>
  
<target name="-gc2cva" unless="${okay}">
  <echo message='Creating CVA/XSD from "${source}" GC file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-gc2obdndr.xsl"/>
     <arg value="-s:${source}"/>
     <arg value="-o:${dir}/${UBLstage}-${UBLversion}/junk.out"/>
     <arg value="config-uri=${config}"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
     <arg value="extensions-for-abies=${abieExtensions}"/>
  </java>
</target>
  
<target name="-gc2ndrExt" unless="${okay}">
  <echo message='Checking "${source}" GC file against NDR...'/>
  <touch file="${dir}/${words}"/>
  <property name="words-uri" location="${dir}/${words}"/>
  <property name="dict-uri" location="${dir}/spellcheck-UBL.txt"/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-checkgc4obdndr.xsl"/>
     <arg value="-o:${report}"/>
     <arg value="-s:${source}"/>
     <arg value="config-uri=${config}"/>
     <arg value="title-suffix=${title}"/>
     <arg value="change-suffix=${change}"/>
     <arg value="old-uri=${compare}"/>
     <arg value="docbook-common-uri=${dbcmn}"/>
     <arg value="docbook-maindoc-uri=${dbmain}"/>
     <arg value="den-word-list-uri=${words-uri}"/>
     <arg value="common-library-singleton-model-name=${library}"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
  </java>
  <echo message='Spell-checking the resulting word list into ${dir}/unexpectedWordsExt.txt (run "aspell -p ./spellcheck-UBL.txt check ${words-uri}" if abend)...'/>
  <exec executable="sh">
    <arg value="-c"/>
    <arg value='aspell -l EN -p ${dict-uri} list &lt;${words-uri} | tee ${dir}/unexpectedWordsExt.txt | wc -w | sed "s/ //g" | grep "^0$"'/>
  </exec>
  <echo message='Creating CVA/XSD extension from "${source}" GC file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-gc2obdndr.xsl"/>
     <arg value="-s:${source}"/>
     <arg value="-o:${dir}/${UBLstage}-${UBLversion}/junk.out"/>
     <arg value="config-uri=${config}"/>
     <arg value="base-config-uri=${basecf}"/>
     <arg value="base-gc-uri=${basegc}"/>
     <arg value="common-library-singleton-model-name=${library}"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
  </java>
</target>
  
<target name="-cva2xsl" unless="${okay}">
  <delete file="${cvaout}"/>
  <delete file="${xslout}"/>
  <copy preservelastmodified="true" file="${schin}" todir="${dir}/${UBLstage}-${UBLversion}/cva"/>
  <echo message='Creating CVA documentation from "${cvain}" CVA file...'/>
  <java append="true" classname="com.icl.saxon.StyleSheet">
     <arg value="-o"/>
     <arg value="${cvaout}"/>
     <arg value="${cvain}"/>
     <arg value="${utilitydir}Crane-cva-gc-xsl-${cvagcxsl}/Crane-cva2html.xsl"/>
  </java>
  <echo message='Creating XSL validation from "${cvain}" CVA file...'/>
  <java append="true" classname="com.icl.saxon.StyleSheet">
     <arg value="-o"/>
     <arg value="${cvain}.temp.xsl"/>
     <arg value="${cvain}"/>
     <arg value="${utilitydir}Crane-cva2sch-${cva2sch}/utility/Crane-cva2schXSLT.xsl"/>
  </java>
  <java append="true" classname="com.icl.saxon.StyleSheet">
     <arg value="-o"/>
     <arg value="${schadd}"/>
     <arg value="${cvain}.temp.xsl"/>
     <arg value="${cvain}.temp.xsl"/>
  </java>
  <java append="true" classname="com.icl.saxon.StyleSheet">
     <arg value="-o"/>
     <arg value="${schin}.temp.sch"/>
     <arg value="${schin}"/>
     <arg value="${utilitydir}Crane-cva2sch-${cva2sch}/utility/iso_schematron_assembly.xsl"/>
  </java>
  <java append="true" classname="com.icl.saxon.StyleSheet">
     <arg value="-o"/>
     <arg value="${xslout}"/>
     <arg value="${schin}.temp.sch"/>
     <arg value="${utilitydir}Crane-cva2sch-${cva2sch}/utility/Message-Schematron-terminator.xsl"/>
  </java>
  <delete file="${schin}.temp.sch"/>
  <delete file="${cvain}.temp.xsl"/>
  <echo message='Completed creating CVA/XSD artefacts'/>
</target>

<target name="-gc2html" unless="${okay}">
  <delete file="${dir}/${UBLstage}-${UBLversion}/mod/summary/reports"/>
  <property name="alldocsname" value="All-UBL-${UBLversion}-Documents"/>
  <property name="doAllOnly" value="no"/>
  <property name="parallelGroupCount" value="16"/>
  <echo message='Creating HTML reports (group ${group}) from "${source}" GC file...'/>
  <java append="true" classname="net.sf.saxon.Transform">
     <arg value="-xsl:${utilitydir}Crane-gc2obdndr-${gc2obdndr}/Crane-gc2obdsummary.xsl"/>
     <arg value="-s:${source}"/>
     <arg value="-o:${dir}/${UBLstage}-${UBLversion}/mod/summary/reports/junk.out"/>
     <arg value="all-documents-base-name=${alldocsname}"/>
     <arg value="title-prefix=${title} ${UBLstage}"/>
     <arg value="date-time=${version}"/>
     <arg value="parallel-group-index=${group}"/>
     <arg value="parallel-group-count=${parallelGroupCount}"/>
     <arg value="common-library-singleton-model-name=${library}"/>
     <arg value="copyright-text=Copyright &#169; OASIS Open"/>
     <arg value="--suppressXsltNamespaceCheck:on"/>
     <arg value="do-all-only=${doAllOnly}"/>
  </java>
</target>

<target name="-codelists">
  <echo message="Testing code list files..."/>
  <exec executable="sh" resultproperty="returnCLlist" 
        dir="${dir}/${UBLstage}-${UBLversion}/cl"
        output="${dir}/codeListCheckList.txt">
    <arg value="-c"/>
    <arg value="find . -name \*.gc -print"/>
  </exec>
  <exec executable="sh" resultproperty="returnCLparse" errorproperty="ignore"
        dir="${dir}/${UBLstage}-${UBLversion}/cl"
        output="${dir}/codeListCheckGood.txt">
    <arg value="-c"/>
    <arg value="find . -name \*.gc -exec sh ../val/w3cschema.sh ${utilitydir}/genericode/xsd/genericode.xsd {} \;
      -print | grep /gc/"/>
  </exec>
  <exec executable="sh" resultproperty="returnCLdiff" dir="${dir}"
        output="${dir}/${UBLstage}-${UBLversion}/LIST-OF-PROBLEM-CODE-LISTS.txt">
    <arg value="-c"/>
    <arg value="diff codeListCheckList.txt codeListCheckGood.txt"/>
  </exec>
  <condition property="reportCLdiff">
    <not>
      <and>
        <isset property="returnCLdiff"/>
        <equals arg1="${returnCLdiff}" arg2="0"/>
      </and>
    </not>
  </condition>
  <delete unless:set="reportCLdiff" file="${dir}/${UBLstage}-${UBLversion}/LIST-OF-PROBLEM-CODE-LISTS.txt"/>
</target>

<target name="-samples">
  <echo message="Checking the use of namespace URI strings and processing instructions..."/>
  <exec executable="sh" outputproperty="countBadNSPI">
    <arg value="-c"/>
    <arg value='java -jar ${utilitydir}Crane-gc2obdndr-${gc2obdndr}/saxon9he/saxon9he.jar 
-s:namespaceCheck.xsl -xsl:namespaceCheck.xsl "dir=${dir}/${UBLstage}-${UBLversion}/xml" | grep "^ " | grep -E -v "ubl:schema:xsd:(SignatureBasicComponents|CommonExtensionComponents)-2" | tee ${dir}/${UBLstage}-${UBLversion}/UNEXPECTED-SAMPLES-NS-PI-DETAILS.txt | wc -l | sed "s/ //g"'/>
  </exec>
  <condition property="badNSPI">
    <not>
      <equals arg1="${countBadNSPI}" arg2="0"/>
    </not>
  </condition>
  <echo if:set="badNSPI" message="ERROR Found ${countBadNSPI} rogue namespaces or processing instructions in sample files"/>
  <delete unless:set="badNSPI" file="${dir}/${UBLstage}-${UBLversion}/UNEXPECTED-SAMPLES-NS-PI-DETAILS.txt"/>
  
  <echo message="Checking consistency of invocation scripts..."/>
  <exec executable="sh" outputproperty="countXMLdirectory">
    <arg value="-c"/>
    <arg value='ls ${dir}/${UBLstage}-${UBLversion}/xml | wc -l | sed "s/ //g"'/>
  </exec>  
  <exec executable="sh" outputproperty="countXMLshell">
    <arg value="-c"/>
    <arg value='grep validate ${dir}/${UBLstage}-${UBLversion}/val/testsamples.sh | wc -l | sed "s/ //g"'/>
  </exec>  
  <condition property="mismatchedSamplesShell">
    <not>
      <equals arg1="${countXMLdirectory}" arg2="${countXMLshell}"/>
    </not>
  </condition>
  <touch if:set="mismatchedSamplesShell" file="${dir}/${UBLstage}-${UBLversion}/MISMATCHED-TEST-SAMPLES-SH-WARNING.txt"/>
  <exec executable="sh" outputproperty="countXMLbatch">
    <arg value="-c"/>
    <arg value='grep validate ${dir}/${UBLstage}-${UBLversion}/val/testsamples.sh | wc -l | sed "s/ //g"'/>
  </exec>
  <condition property="mismatchedSamplesBatch">
    <not>
      <equals arg1="${countXMLdirectory}" arg2="${countXMLbatch}"/>
    </not>
  </condition>
  <touch if:set="mismatchedSamplesBatch" file="${dir}/${UBLstage}-${UBLversion}/MISMATCHED-TEST-SAMPLES-BAT-WARNING.txt"/>
  
  <echo message="Testing validation error files..."/>
  <exec executable="sh" resultproperty="returnTest" dir="${dir}/${UBLstage}-${UBLversion}/val">
    <arg value="test.sh"/>
  </exec>
  <condition property="reportTest">
    <not>
      <and>
        <isset property="returnTest"/>
        <equals arg1="${returnTest}" arg2="0"/>
      </and>
    </not>
  </condition>
  <touch if:set="reportTest" file="${dir}/${UBLstage}-${UBLversion}/UNEXPECTED-TEST-RESULT-WARNING.txt"/>
  <echo/>
  <echo/>
  
  <echo message="Validating sample test files..."/>
  <exec executable="sh" resultproperty="returnTestSamples" dir="${dir}/${UBLstage}-${UBLversion}/val">
    <arg value="-e"/>
    <arg value="testsamples.sh"/>
  </exec>
  <condition property="reportTestSamples">
    <not>
      <and>
        <isset property="returnTestSamples"/>
        <equals arg1="${returnTestSamples}" arg2="0"/>
      </and>
    </not>
  </condition>
  <touch if:set="reportTestSamples" file="${dir}/${UBLstage}-${UBLversion}/UNEXPECTED-TEST-SAMPLES-RESULT-WARNING.txt"/>
  <delete file="${dir}/${UBLstage}-${UBLversion}/val/output.txt"/>
  
</target>

<target name="-package">
  <delete dir="${dir}/artefacts-${package}-${UBLstage}-${version}"/>
  <mkdir dir="${dir}/artefacts-${package}-${UBLstage}-${version}"/>
  <copy preservelastmodified="true" todir="${dir}/artefacts-${package}-${UBLstage}-${version}">
    <fileset dir="${dir}/${UBLstage}-${UBLversion}">
     <include name="**"/>
    </fileset>
  </copy>
  <touch if:set="skip-gc" file="${dir}/artefacts-${package}-${UBLstage}-${version}/GC-FILES-NOT-REGENERATED.txt"/>
  <touch if:set="skip-spreadsheet-generation" file="${dir}/artefacts-${package}-${UBLstage}-${version}/ODS-XLS-FILES-NOT-GENERATED.txt"/>
  <touch if:set="skip-html-generation" file="${dir}/artefacts-${package}-${UBLstage}-${version}/HTML-FILES-NOT-GENERATED.txt"/>
  <mkdir dir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution"/>
  <mkdir dir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution/json"/>
  <mkdir dir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution/json/val"/>
  <copy preservelastmodified="true"  includeEmptyDirs="false"
       todir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution">
    <fileset dir=".">
      <include name="**"/>
      <exclude name="**/.git/**"/>
      <exclude name="**/.github/**"/>
      <exclude name="**/utilities/**"/>
      <exclude name="**/raw/**"/>
      <exclude name="**/${dir}/**"/>
    </fileset>
  </copy>
  <move preservelastmodified="true" includeEmptyDirs="false" todir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution">
    <fileset dir="${dir}">
      <include name="*"/>
      <exclude name="artefacts.*.txt"/>
    </fileset>
  </move>
  <move preservelastmodified="true" todir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution/json">
    <fileset dir="${dir}/artefacts-${package}-${UBLstage}-${version}">
      <include name="json/**"/>
      <include name="json-schema/**"/>
    </fileset>
  </move>
  <move preservelastmodified="true" todir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution/json/val">
    <fileset dir="${dir}/artefacts-${package}-${UBLstage}-${version}/val">
      <include name="*json*"/>
    </fileset>
  </move>
  <move preservelastmodified="true" todir="${dir}/artefacts-${package}-${UBLstage}-${version}/archive-only-not-in-final-distribution">
    <fileset dir="${dir}/artefacts-${package}-${UBLstage}-${version}">
      <include name="master-code-list-*.xml"/>
    </fileset>
  </move>
  
  <!--remove unneeded files to reduce storage burden-->
  <delete dir="${dir}/os-UBL-2.0"/>
  <delete dir="${dir}/os-UBL-2.1"/>
  <delete dir="${dir}/os-UBL-2.2"/>
  <delete dir="${dir}/${UBLstage}-${UBLversion}"/>
  
<!--
    Cannot create zip until console log and error exit files added to archive. 
    
  <delete file="${dir}/artefacts-${package}-${UBLstage}-${version}.zip"/>

  <zip destfile="${dir}/artefacts-${package}-${UBLstage}-${version}.zip"
       basedir="${dir}" includes="artefacts-${package}-${UBLstage}-${version}/**"/>
  <delete dir="${dir}/artefacts-${package}-${UBLstage}-${version}"/>
  <unzip src="${dir}/artefacts-${package}-${UBLstage}-${version}.zip" 
         dest="${dir}" />
-->
  <!--documentation-->
  <echo message="stage=${UBLstage}"/>
  <echo message="version=${version}"/>
  
</target>

</project>